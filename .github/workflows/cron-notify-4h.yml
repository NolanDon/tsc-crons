name: 🔁 Notify Sweep (every 4h)

on:
  schedule:
    # ── 4-hour sweep ───────────────────────────────────────────────────────────────
    # Runs every 4 hours, at minute 07, starting from midnight UTC.
    # Fires at: 00:07, 04:07, 08:07, 12:07, 16:07, 20:07 (UTC) — 6× per day.
    - cron: "07 */4 * * *"   # every 4 hours at minute 7 (UTC)
  workflow_dispatch: {}

permissions:
  contents: read

concurrency:
  group: notify-4h
  cancel-in-progress: true

jobs:
  call-notify-4h:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      - name: Call notify endpoint (tier=4hr)
        shell: bash
        env:
          BASE_URL: ${{ secrets.BACKEND_BASE_URL }}
          PATH_PART: ${{ secrets.NOTIFY_PATH }} 
          HDR_NAME: ${{ secrets.INTERNAL_HEADER_NAME }} 
          HDR_VALUE: ${{ secrets.INTERNAL_API_KEY }}
        run: |
          set -euo pipefail
          URL="${BASE_URL%/}${PATH_PART}"
          curl -sSf -X POST "$URL" \
            -H "content-type: application/json" \
            -H "$HDR_NAME: $HDR_VALUE" \
            --data '{"tier":"every4hr"}'
